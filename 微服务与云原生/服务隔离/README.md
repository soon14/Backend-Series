# 服务隔离

在微服务架构中，我们经常会提到雪崩效应（Avalanche Effect）这一概念。服务雪崩的产生是一种扩散效应。当系统中存在两个服务A和B，如果A服务出现问题，而B服务会通过用户不断提交服务请求等手工重试或代码逻辑自动重试等手段进一步加大对A服务的访问流量。因为B服务使用同步调用，会产生大量的等待线程占用系统资源。一旦线程资源被耗尽，B服务提供的服务本身也将处于不可用状态，整个过程的演变可参考下图。而这一效果在整个服务访问链路上进行扩散，就形成了雪崩效应。

雪崩效应的预防需要依赖于架构设计中的一种称为舱壁隔离（Bulkhead Isolation）的架构模式。所谓舱壁隔离，顾名思义就是像舱壁一样对资源或失败单元进行隔离，如果一个船舱破了进水，只损失一个船舱，其他船舱可以不受影响。舱壁隔离模式在微服务架构中的应用就是各种服务隔离思想。

隔离是微服务架构中最重要的特性，也是实现反应式宣言中所提倡的弹性、可伸缩系统的前提。所谓弹性，就是从失败中恢复的能力，依赖于这种舱壁和失败隔离的设计，并且需要打破同步通信机制。由此，微服务一般是在边界之间使用异步消息传输，从而使得正常的业务逻辑避免对捕获错误、错误处理的依赖。