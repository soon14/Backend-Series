# 冗余设计

工程学中的冗余是指系统为了提升其可靠度，刻意配置重复的零件或是机能。冗余一般是为了备用，或是失效安全的考量，也有可能是了提升系统性能，像是卫星导航系统接收器，或是多线程电脑处理。

在计算机科学中，主要有以下几种不同的冗余，分别是：

- 硬件冗余，例如双重模块冗余及三重模块冗余
- 信息冗余，例如错误检测与纠正方法
- 时间冗余，进行同一个任务数次，例如执行同一个程式数次，或是传输同一笔资料数次等
- 软件冗余，例如 N 版本编程（N2Version Programming, NVP）,是由 Elmendor 提出并经 Avinienis 等人完善与实现的一种静态容错技术，它使用多个不同的软件版本利用决策机制和前向恢复实现容错。另一种由软件冗余衍生，但应用在硬件上的冗余是不同功能冗余，像是车辆中同时有机械刹车及油压刹车。此作法是用软件中的例子，二个独立由不同人写作，有相同功能的模组，针对同一信号产生相同的输出。

![](https://i.postimg.cc/MTWFX5rX/image.png)

一个网站，从基础的硬件层，到操作系统层，到数据库层，到应用程序层，再到网络层，都有可能产生单点故障。如果要有效地消除单点故障，最重要的一点是设计的时候要尽量避免引入单点，随着架构的变化，定期审查系统潜在的单点也是有必要的。如下面一些常见的审查：

IDC 机房的单点，至少要两个 IDC 共存
机房的电力双线冗余，UPS、柴发随时准备
增加硬盘，做镜像，让出错的概率降低；
网卡与网线的单点问题，绑定多块网卡；
数据库至少要做好一主一备
负载均衡、反向代理至少一个集群有两个节点
靠谱的 DNS 解析
...

在应用程序层，一般来说是增加应用的部署节点，然后用一定的策略进行流量的分配。但实际上，我们需要根据应用的场景来做细分，针对不同的应用场景， 解决单点问题需要思考和关注的点是不同的。毕竟应用里面有复杂的业务逻辑，是直接面向用户产生业务价值的。一般而言我们把应用层分成无状态应用和有状态应用，针对这两种类型的应用，我们做冗余的方法是完全不一样的。

# 无状态应用

针对无状态的应用，处理上相对比较简单。我可以增加应用的部署节点，然后把流量随机分配到这些应用结点上即可。典型的就是 Nginx 集群、简单的业务系统，这些系统没有状态，水平扩展集群即可提升集群的整体冗余能力。

# 有状态应用
