# 模板匹配

在 app 开发中，测试人员需要对新开发的功能进行各种测试，其中有个重要环节是对 app 页面进行一条链路的回归测试。比如在测试支付宝切换账号登录的操作是否正常时，就要人工依次点击（假设当前页面已在支付宝首页）：“我的”,“设置”，“退出登录”，“换个账号登录”，输入新账号，“下一步”，输入密码，“登陆”，如果一切正常就能重新回到支付宝首页，这就是一条测试换账号登录功能的完整回归链路。一个很显然的思路就是预先将一条链路中要点击的区域抠成图像块（模板），然后利用图像块在当前页面去匹配，一旦命中，就触发点击行为，进入下一页；继续这种模板匹配的操作，直到完成整个链路，就能自动化地完成了回归测试。所以抽象出来，这其实就是计算机视觉中经典的模板匹配问题。

实际上，模板匹配方法无非就是用模板去和被匹配图像的局部像素块进行相似度计算，选择相似度高的局部像素块作为命中区域，达到匹配定位的目的。传统特征工程，提取的浅层特征无法准确表达模板和局部像素块的信息，导致计算的相似度误差很大。为此，我们对模板和局部像素块分别提取深度特征，通过计算深度特征之间的相似度来进行匹配识别，准确度大大提升。考虑到图像局部像素块的数目巨大，为了提升匹配速度，我们先对整个页面做一个热区检测。将模板匹配问题转化为了先对 app 页面的热区进行检测提取，再用预先抠出的模板和这些热区进行深度特征比对的问题。

# 热区检测

利用深度学习进行目标检测，需要一个打标的热区数据集。为此，我们尝试 android 系统工具辅助生成打标框，得到 app 中页面所有控件的坐标，作为热区坐标的备选项；再利用人工过滤和辅助标框的方式，得到热区坐标，构成了热区数据集。

# 相似度匹配

# 异常页面与悬浮窗
